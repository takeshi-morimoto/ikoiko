# HTTPからHTTPSへのリダイレクト
<IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteCond %{HTTPS} off
    RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]
    
    # index_modern.phpからindex.phpへのリダイレクト
    RewriteRule ^index_modern\.php$ /ikoiko/ [L,R=301]
    
    # ディレクトリURLを対応するPHPファイルにリダイレクト
    RewriteRule ^machi/?$ /ikoiko/machi.php [L]
    RewriteRule ^ani/?$ /ikoiko/index.php [L]
    RewriteRule ^nazo/?$ /ikoiko/nazo.php [L]
    RewriteRule ^off/?$ /ikoiko/off.php [L]
    
    # eventディレクトリURLをevent.phpに転送（PATH_INFO付き）
    RewriteCond %{REQUEST_URI} ^/ikoiko/event/(.+)/$
    RewriteRule ^event/(.+)/$ /ikoiko/event.php/$1 [L]
    
    RewriteCond %{REQUEST_URI} ^/ikoiko/event_m/(.+)/$
    RewriteRule ^event_m/(.+)/$ /ikoiko/event_m.php/$1 [L]
    
    # 末尾スラッシュの正規化（event, event_mページ用）
    RewriteCond %{REQUEST_URI} ^/ikoiko/event/[^/]+$
    RewriteRule ^(.*)$ $1/ [L,R=301]
    
    RewriteCond %{REQUEST_URI} ^/ikoiko/event_m/[^/]+$
    RewriteRule ^(.*)$ $1/ [L,R=301]
    
    # PATH_INFOを使用するページのリダイレクト（正規化）
    # list_1.php, list_2.phpなどのPATH_INFO付きURLを正規URLにリダイレクト
    RewriteCond %{REQUEST_URI} ^/ikoiko/(list_[1-4]\.php|list_[1-4])/(.+)$
    RewriteRule ^ikoiko/(list_[1-4])(\.php)?/(.+)$ /ikoiko/$1.php [L,R=301]
    
    # event.php, event_m.phpのPATH_INFO形式を正規化
    RewriteCond %{REQUEST_URI} ^/ikoiko/event\.php/(.+)$
    RewriteRule ^ikoiko/event\.php/(.+)$ /ikoiko/event/$1/ [L,R=301]
    
    RewriteCond %{REQUEST_URI} ^/ikoiko/event_m\.php/(.+)$
    RewriteRule ^ikoiko/event_m\.php/(.+)$ /ikoiko/event_m/$1/ [L,R=301]
    
    # machi.php, index.phpの末尾スラッシュを削除
    RewriteCond %{REQUEST_URI} ^/ikoiko/(machi|index)\.php/$
    RewriteRule ^ikoiko/(machi|index)\.php/$ /ikoiko/$1.php [L,R=301]
</IfModule>

# カスタムphp.iniの読み込み
<IfModule mod_suphp.c>
    suPHP_ConfigPath /home/users/1/lolipop.jp-30251d4519441da4/web/ikoiko/
</IfModule>

# PHPINIディレクティブ（Lolipop用）
# 注意: auto_prepend_fileにphp.iniを指定するとその内容が出力されるため無効化
# <IfModule mod_php.c>
#     php_value auto_prepend_file "/home/users/1/lolipop.jp-30251d4519441da4/web/ikoiko/php.ini"
# </IfModule>

# OPcache設定（PHP 7.0以降）
<IfModule mod_php7.c>
    php_flag opcache.enable On
    php_value opcache.memory_consumption 128
    php_value opcache.interned_strings_buffer 8
    php_value opcache.max_accelerated_files 4000
    php_value opcache.revalidate_freq 60
    php_value opcache.fast_shutdown 1
    php_flag opcache.enable_cli Off
    php_value opcache.max_wasted_percentage 5
    php_value opcache.validate_timestamps 1
    php_flag opcache.save_comments 1
</IfModule>

# PHP 8.0以降の場合
<IfModule mod_php.c>
    php_flag opcache.enable On
    php_value opcache.memory_consumption 128
    php_value opcache.interned_strings_buffer 8
    php_value opcache.max_accelerated_files 4000
    php_value opcache.revalidate_freq 60
    php_value opcache.fast_shutdown 1
    php_flag opcache.enable_cli Off
    php_value opcache.max_wasted_percentage 5
    php_value opcache.validate_timestamps 1
    php_flag opcache.save_comments 1
    php_flag opcache.jit 1
    php_value opcache.jit_buffer_size 100M
</IfModule>

# MIMEタイプの設定
<IfModule mod_mime.c>
    AddType text/css .css
    AddType application/javascript .js
    AddType application/x-javascript .js
    AddType text/javascript .js
</IfModule>

# セキュリティヘッダー
<IfModule mod_headers.c>
    Header set X-Content-Type-Options "nosniff"
    Header set X-Frame-Options "SAMEORIGIN"
    Header set X-XSS-Protection "1; mode=block"
    # HSTS（HTTP Strict Transport Security）- 1年間
    Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains"
</IfModule>

# Gzip圧縮の有効化
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json
</IfModule>

# ブラウザキャッシュの設定
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType image/jpg "access plus 1 month"
    ExpiresByType image/jpeg "access plus 1 month"
    ExpiresByType image/gif "access plus 1 month"
    ExpiresByType image/png "access plus 1 month"
    ExpiresByType text/css "access plus 1 week"
    ExpiresByType application/javascript "access plus 1 week"
    ExpiresByType text/javascript "access plus 1 week"
</IfModule>